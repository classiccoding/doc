<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
 <LINK REL="stylesheet" TYPE="text/css" HREF="doc.css">
 <META NAME="GENERATOR" CONTENT="LinuxDoc-Tools 0.9.66">
 <TITLE>Ohio Scientific-specific information for cc65</TITLE>
</HEAD>
<BODY>
<H1>Ohio Scientific-specific information for cc65</H1>

<H2>
<A HREF="mailto:stephan.muehlstrasser@web.de">Stephan M&uuml;hlstrasser</A><BR></H2>2015-02-04
<HR>
<EM>An overview over the Ohio Scientific runtime system as it is implemented for the cc65 C
compiler.</EM>
<HR>
<P>
<H2><A NAME="toc1">1.</A> <A HREF="osi.html#s1">Overview</A></H2>

<P>
<H2><A NAME="toc2">2.</A> <A HREF="osi.html#s2">Targets</A></H2>

<P>
<H2><A NAME="toc3">3.</A> <A HREF="osi.html#s3">Binary format</A></H2>

<P>
<H2><A NAME="toc4">4.</A> <A HREF="osi.html#s4">Memory layout</A></H2>

<P>
<H2><A NAME="toc5">5.</A> <A HREF="osi.html#s5">Linker configurations</A></H2>

<UL>
<LI><A NAME="toc5.1">5.1</A> <A HREF="osi.html#ss5.1">default config file (<CODE>osic1p.cfg</CODE>)</A>
<LI><A NAME="toc5.2">5.2</A> <A HREF="osi.html#ss5.2"><CODE>osic1p-asm.cfg</CODE></A>
</UL>
<P>
<H2><A NAME="toc6">6.</A> <A HREF="osi.html#s6">Platform-specific header files</A></H2>

<UL>
<LI><A NAME="toc6.1">6.1</A> <A HREF="osi.html#ss6.1">Ohio Scientific-specific functions</A>
<LI><A NAME="toc6.2">6.2</A> <A HREF="osi.html#ss6.2">Hardware access</A>
</UL>
<P>
<H2><A NAME="toc7">7.</A> <A HREF="osi.html#s7">Loadable drivers</A></H2>

<P>
<H2><A NAME="toc8">8.</A> <A HREF="osi.html#s8">Limitations</A></H2>

<UL>
<LI><A NAME="toc8.1">8.1</A> <A HREF="osi.html#ss8.1">conio implementation</A>
<LI><A NAME="toc8.2">8.2</A> <A HREF="osi.html#ss8.2">stdio implementation</A>
</UL>
<P>
<H2><A NAME="toc9">9.</A> <A HREF="osi.html#s9">Other hints</A></H2>

<UL>
<LI><A NAME="toc9.1">9.1</A> <A HREF="osi.html#ss9.1">Passing arguments to the program</A>
<LI><A NAME="toc9.2">9.2</A> <A HREF="osi.html#ss9.2">Program return code</A>
</UL>
<P>
<H2><A NAME="toc10">10.</A> <A HREF="osi.html#s10">License</A></H2>


<HR>
<H2><A NAME="s1">1.</A> <A HREF="#toc1">Overview</A></H2>


<P>This file contains an overview of the Ohio Scientific runtime system as it comes with the
cc65 C compiler. It describes the memory layout, Ohio Scientific-specific header files,
and any pitfalls specific to that platform.</P>
<P>Please note that Ohio Scientific-specific functions are just mentioned here, they are
described in detail in the separate 
<A HREF="funcref.html">function reference</A>. Even functions marked as "platform dependent" may be available on
more than one platform. Please see the function reference for more
information.</P>

<H2><A NAME="s2">2.</A> <A HREF="#toc2">Targets</A></H2>


<P>Currently the target "osic1p" is implemented. This works for the Ohio Scientific
Challenger 1P machine.</P>

<H2><A NAME="s3">3.</A> <A HREF="#toc3">Binary format</A></H2>


<P>The standard binary output format generated by the linker for the osic1p target
is a machine language program.</P>

<P>For uploading into a real machine over the serial port or into an emulator a
program must be converted to a text file that is understood by the 65V PROM
monitor. For this purpose the srec_cat program from the
<A HREF="http://srecord.sourceforge.net/">SRecord</A>
tool collection can be used.</P>
<P>Care must be taken that the -offset and -execution-start-address options for the srec_cat
program correspond to the start address of the executable.</P>
<P>Example for converting an executable "hello" that was built for the default
start address $0200 to an uploadable file "hello.c1p":</P>
<P>
<BLOCKQUOTE><CODE>
srec_cat hello -binary -offset 0x200 -o hello.c1p -Ohio_Scientific -execution-start-address=0x200
</CODE></BLOCKQUOTE>
</P>

<H2><A NAME="s4">4.</A> <A HREF="#toc4">Memory layout</A></H2>


<P>By default programs compiled for the osic1p target are configured for 32 kB RAM.
The RAM size can be configured via the symbol __HIMEM__.</P>
<P>Special locations:</P>
<P>
<DL>
<DT><B>Program start address</B><DD>
<P>The default start address is $0200. The start address is configurable
via the compiler option --start-addr.</P>

<DT><B>Stack</B><DD>
<P>The C runtime stack is located at the top of RAM and growing downwards.
The size is configurable via the symbol __STACKSIZE__. The default
stack size is $0400.</P>

<DT><B>Heap</B><DD>
<P>The C heap is located at the end of the program and grows towards the C
runtime stack.</P>

<DT><B>Video RAM</B><DD>
<P>The 1 kB video RAM is located at $D000. On the monitor only a subset
of the available video RAM is visible. The address of the upper left corner
of the visible area is $D085 and corresponds to conio cursor
position (0, 0).</P>

</DL>
</P>

<P>Example for building a program with start address $0300, stack size
$0200 and RAM size $2000:</P>
<P>
<BLOCKQUOTE><CODE>
cl65 --start-addr 0x300 -Wl -D,__HIMEM__=$2000,-D,__STACKSIZE__=$0200 -t osic1p hello.c
</CODE></BLOCKQUOTE>
</P>

<H2><A NAME="s5">5.</A> <A HREF="#toc5">Linker configurations</A></H2>


<P>The ld65 linker comes with a default config file "osic1p.cfg" for the Ohio Scientific
Challenger 1P, which is implicitly used via <CODE>-t osic1p</CODE>. The
osic1p package comes with additional secondary linker config files, which are
used via <CODE>-t osic1p -C &lt;configfile&gt;</CODE>.</P>

<H2><A NAME="ss5.1">5.1</A> <A HREF="#toc5.1">default config file (<CODE>osic1p.cfg</CODE>)</A>
</H2>


<P>The default configuration is tailored to C programs.</P>

<H2><A NAME="ss5.2">5.2</A> <A HREF="#toc5.2"><CODE>osic1p-asm.cfg</CODE></A>
</H2>


<P>This configuration is made for assembler programmers who don't need a special
setup.</P>
<P>To use this config file, assemble with <CODE>-t osic1p</CODE> and link with
<CODE>-C osic1p-asm.cfg</CODE>. The former will make sure that correct runtime library
is used, while the latter supplies the actual config. When using <CODE>cl65</CODE>,
use both command line options.</P>
<P>Sample command line for <CODE>cl65</CODE>:</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
cl65 -o program -t osic1p -C osic1p-asm.cfg source.s
</PRE>
</CODE></BLOCKQUOTE>
</P>

<H2><A NAME="s6">6.</A> <A HREF="#toc6">Platform-specific header files</A></H2>


<P>Programs containing Ohio Scientific-specific code may use the <CODE>osic1p.h</CODE> 
header file. </P>

<H2><A NAME="ss6.1">6.1</A> <A HREF="#toc6.1">Ohio Scientific-specific functions</A>
</H2>


<P>There are currently no special Ohio Scientific functions.</P>

<H2><A NAME="ss6.2">6.2</A> <A HREF="#toc6.2">Hardware access</A>
</H2>


<P>There is no specific support for direct hardware access.</P>

<H2><A NAME="s7">7.</A> <A HREF="#toc7">Loadable drivers</A></H2>


<P>There are no loadable drivers available.</P>

<H2><A NAME="s8">8.</A> <A HREF="#toc8">Limitations</A></H2>



<H2><A NAME="ss8.1">8.1</A> <A HREF="#toc8.1">conio implementation</A>
</H2>


<P>The conio implementation is complete except for a kbhit() function. </P>

<H2><A NAME="ss8.2">8.2</A> <A HREF="#toc8.2">stdio implementation</A>
</H2>


<P>There is no support for stdio at the moment.</P>

<H2><A NAME="s9">9.</A> <A HREF="#toc9">Other hints</A></H2>



<H2><A NAME="ss9.1">9.1</A> <A HREF="#toc9.1">Passing arguments to the program</A>
</H2>


<P>There is currently no support for passing arguments to a program.</P>

<H2><A NAME="ss9.2">9.2</A> <A HREF="#toc9.2">Program return code</A>
</H2>


<P>The program return code currently has no effect. When the main() function
finishes, the boot prompt is shown again.</P>

<H2><A NAME="s10">10.</A> <A HREF="#toc10">License</A></H2>


<P>This software is provided 'as-is', without any expressed or implied
warranty.  In no event will the authors be held liable for any damages
arising from the use of this software.</P>
<P>Permission is granted to anyone to use this software for any purpose,
including commercial applications, and to alter it and redistribute it
freely, subject to the following restrictions:</P>
<P>
<OL>
<LI>    The origin of this software must not be misrepresented; you must not
claim that you wrote the original software. If you use this software
in a product, an acknowledgment in the product documentation would be
appreciated but is not required.</LI>
<LI>    Altered source versions must be plainly marked as such, and must not
be misrepresented as being the original software.</LI>
<LI>    This notice may not be removed or altered from any source
distribution.</LI>
</OL>
</P>

</BODY>
</HTML>
